<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http
://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.5.xsd">
	<header>
		<license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>
		<title lang="en">PhpBB Kb update from 1.0.2RC3 to 1.0.2</title>
		<description lang="en">This is the update file for 1.0.2RC3 to 1.0.2</description>
		<author-notes lang="en">This mod is a work in progress, so if you encounter any bugs or you have any features you want implemented, please do not hesitate to go to our website and tell us. This mod should be combitable with most other modifications, however, there are exceptions.</author-notes>
		<author-group>
			<author>
				<realname>Andreas Nexmann</realname>
				<email>softphp@gmail.com</email>
				<username>Imladris</username>
				<homepage>http://kb.softphp.dk</homepage>
				<contributions-group>
      		 		<contributions status="current" from="2009-05-01" position="Developer"/>
      			</contributions-group>
			</author>
			<author>
				<realname>Tom Martin</realname>
				<email>tom.martin60@btinternet.com</email>
				<username>Poppertom69</username>
				<homepage></homepage>
				<contributions-group>
      		  		<contributions status="current" from="2009-05-01" position="Developer"/>
      			</contributions-group>
			</author>
			<author>
				<realname>C1</realname>
				<email>C1WebDesign@gmail.com</email>
				<username>thecharmed01</username>
				<homepage></homepage>
				<contributions-group>
      		  		<contributions status="past" from="2009-08-01" to="2009-11-16" position="Stylist"/>
      			</contributions-group>
			</author>
		</author-group>
		<mod-version>1.0.2</mod-version>
		<installation>
			<level>intermediate</level>
			<time>600</time>
			<target-version>3.0.7-PL1</target-version>
		</installation>
		<link-group>
			<link type="parent" realname="Main Install File" href="./../install.xml" lang="en">Parent Install</link>
		</link-group>
	</header>
	<action-group>
		<copy>
			<file from="root/kb.php" to="kb.php" />
									<file from="root/adm/style/acp_kb_cat.html" to="adm/style/acp_kb_cat.html" />
									<file from="root/adm/style/acp_kb_health.html" to="adm/style/acp_kb_health.html" />
									<file from="root/adm/style/acp_kb.html" to="adm/style/acp_kb.html" />
									<file from="root/adm/style/acp_kb_types.html" to="adm/style/acp_kb_types.html" />
									<file from="root/adm/style/acp_kb_plugins.html" to="adm/style/acp_kb_plugins.html" />
									<file from="root/includes/acp/acp_kb_cats.php" to="includes/acp/acp_kb_cats.php" />
									<file from="root/includes/acp/acp_kb_types.php" to="includes/acp/acp_kb_types.php" />
									<file from="root/includes/acp/acp_kb.php" to="includes/acp/acp_kb.php" />
									<file from="root/includes/acp/acp_kb_permissions.php" to="includes/acp/acp_kb_permissions.php" />
									<file from="root/includes/acp/info/acp_kb_cats.php" to="includes/acp/info/acp_kb_cats.php" />
									<file from="root/includes/acp/info/acp_kb_types.php" to="includes/acp/info/acp_kb_types.php" />
									<file from="root/includes/acp/info/acp_kb.php" to="includes/acp/info/acp_kb.php" />
									<file from="root/includes/acp/info/acp_kb_permissions.php" to="includes/acp/info/acp_kb_permissions.php" />
									<file from="root/includes/constants_kb.php" to="includes/constants_kb.php" />
									<file from="root/includes/functions_kb.php" to="includes/functions_kb.php" />
									<file from="root/includes/kb_auth.php" to="includes/kb_auth.php" />
									<file from="root/includes/functions_install_kb.php" to="includes/functions_install_kb.php" />
									<file from="root/includes/functions_plugins_kb.php" to="includes/functions_plugins_kb.php" />
									<file from="root/includes/kb.php" to="includes/kb.php" />
									<file from="root/includes/kb_plugins/*.*" to="includes/kb_plugins/*.*" />
									<file from="root/includes/ucp/ucp_kb.php" to="includes/ucp/ucp_kb.php" />
									<file from="root/includes/ucp/info/ucp_kb.php" to="includes/ucp/info/ucp_kb.php" />
									<file from="root/includes/mcp/mcp_kb.php" to="includes/mcp/mcp_kb.php" />
									<file from="root/includes/mcp/info/mcp_kb.php" to="includes/mcp/info/mcp_kb.php" />
									<file from="root/js/jquery-1.3.2.min.js" to="js/jquery-1.3.2.min.js" />
									<file from="root/language/en/email/kb_email_notify.txt" to="language/en/email/kb_email_notify.txt" />
									<file from="root/language/en/email/kb_notify_email.txt" to="language/en/email/kb_notify_email.txt" />
									<file from="root/language/en/email/kb_notify_pm.txt" to="language/en/email/kb_notify_pm.txt" />
									<file from="root/language/en/mods/info_acp_kb.php" to="language/en/mods/info_acp_kb.php" />
									<file from="root/language/en/mods/info_acp_kb_permissions.php" to="language/en/mods/info_acp_kb_permissions.php" />
									<file from="root/language/en/mods/info_ucp_kb.php" to="language/en/mods/info_ucp_kb.php" />
									<file from="root/language/en/mods/info_mcp_kb.php" to="language/en/mods/info_mcp_kb.php" />
									<file from="root/language/en/mods/kb.php" to="language/en/mods/kb.php" />
									<file from="root/language/en/mods/permissions_kb.php" to="language/en/mods/permissions_kb.php" />
									<file from="root/styles/prosilver/imageset/en/button_article_new.gif" to="styles/prosilver/imageset/en/button_article_new.gif" />
									<file from="root/styles/prosilver/imageset/en/button_comment_new.gif" to="styles/prosilver/imageset/en/button_comment_new.gif" />
									<file from="root/styles/prosilver/imageset/en/button_request_new.gif" to="styles/prosilver/imageset/en/button_request_new.gif" />
									<file from="root/styles/prosilver/template/kb/*.*" to="styles/prosilver/template/kb/*.*" />
									<file from="root/styles/prosilver/theme/kb.css" to="styles/prosilver/theme/kb.css" />
									<file from="root/styles/prosilver/theme/images/*.*" to="styles/prosilver/theme/images/*.*" />
									<file from="root/umil/umil.php" to="umil/umil.php" />
		</copy>
		<open src="download/file.php">
							<edit>
								<find><![CDATA[wrap_img_in_html(append_sid($phpbb_root_path . 'download/file.' . $phpEx, 'id=' . $attachment['attach_id'] . $in_kb), $attachment['real_filename']);]]></find>
								<action type="replace-with"><![CDATA[wrap_img_in_html(append_sid($phpbb_root_path . 'download/file.' . $phpEx, 'id=' . $attachment['attach_id'] . $kb_link), $attachment['real_filename']);]]></action>
							</edit>
		</open>
		<open src="includes/acp/acp_styles.php">
							<edit>
								<find><![CDATA['icon_back_top', 'icon_contact_aim', 'icon_contact_email', 'icon_contact_icq', 'icon_contact_jabber', 'icon_contact_msnm', 'icon_contact_pm', 'icon_contact_yahoo', 'icon_contact_www', 'icon_post_delete', 'icon_post_edit', 'icon_post_info', 'icon_post_quote', 'icon_post_report', 'icon_user_online', 'icon_user_offline', 'icon_user_profile', 'icon_user_search', 'icon_user_warn', 'button_pm_forward', 'button_pm_new', 'button_pm_reply', 'button_topic_locked', 'button_topic_new', 'button_topic_reply', 'button_article_new', 'button_comment_new',]]></find>
								<inline-edit>
									<inline-find><![CDATA['button_comment_new',]]></inline-find>
									<inline-action type="after-add"><![CDATA['button_request_new', ]]></inline-action>
								</inline-edit>
							</edit>
		</open>
		<open src="includes/functions.php">
			<edit>
				<find><![CDATA['L_KB'					=> (isset($config['kb_link_name'])) ? $config['kb_link_name'] : $user->lang['KB'],]]></find>
				<action type="replace-with"><![CDATA['L_KB'					=> (isset($config['kb_link_name']) && $config['kb_link_name'] != '') ? $config['kb_link_name'] : $user->lang['KB'],]]></action>
			</edit>
		</open>
		
		<open src="includes/functions_user.php">
							<edit>
								<find><![CDATA[function user_update_name($old_name, $new_name)
{
	global $config, $db, $cache;]]></find>
								<action type="after-add"><![CDATA[if(!defined('KB_TABLE'))
	{
		global $phpbb_root_path, $phpEx, $table_prefix;
		include($phpbb_root_path . 'includes/constants_kb.' . $phpEx);
	}]]></action>
							</edit>
							<edit>
								<find><![CDATA[TOPICS_TABLE			=> array('topic_first_poster_name', 'topic_last_poster_name'),]]></find>
								<action type="after-add"><![CDATA[KB_TABLE				=> array('article_user_name'),
		KB_COMMENTS_TABLE		=> array('comment_user_name', 'comment_edit_name'),
		KB_EDITS_TABLE			=> array('edit_user_name'),
		KB_REQ_TABLE			=> array('request_user_name'),]]></action>
							</edit>
							<edit>
								<find><![CDATA[$sql = 'UPDATE ' . USERS_TABLE . '
			SET user_new_privmsg = user_new_privmsg - ' . sizeof($ary) . ',
				user_unread_privmsg = user_unread_privmsg - ' . sizeof($ary) . '
			WHERE user_id = ' . $_user_id;
		$db->sql_query($sql);
	}]]></find>
								<action type="after-add"><![CDATA[if(!function_exists('kb_user_delete'))
	{
		include($phpbb_root_path . 'includes/functions_kb.' . $phpEx);
	}
	kb_user_delete($mode, $user_id, $post_username);]]></action>
							</edit>
							<edit>
								<find><![CDATA[$sql = 'UPDATE ' . TOPICS_TABLE . " SET topic_last_poster_colour = '" . $db->sql_escape($sql_ary['user_colour']) . "'
			WHERE " . $db->sql_in_set('topic_last_poster_id', $user_id_ary);
		$db->sql_query($sql);]]></find>
								<action type="after-add"><![CDATA[if(!defined('KB_TABLE'))
		{
			global $phpbb_root_path, $phpEx, $table_prefix;
			include($phpbb_root_path . 'includes/constants_kb.' . $phpEx);
		}
		
		$sql = 'UPDATE ' . KB_TABLE . " SET article_user_color = '" . $db->sql_escape($sql_ary['user_colour']) . "'
				WHERE " . $db->sql_in_set('article_user_id', $user_id_ary);
		$db->sql_query($sql);
		
		$sql = 'UPDATE ' . KB_COMMENTS_TABLE . " SET comment_user_color = '" . $db->sql_escape($sql_ary['user_colour']) . "'
				WHERE " . $db->sql_in_set('comment_user_id', $user_id_ary);
		$db->sql_query($sql);
		
		$sql = 'UPDATE ' . KB_COMMENTS_TABLE . " SET comment_edit_color = '" . $db->sql_escape($sql_ary['user_colour']) . "'
				WHERE " . $db->sql_in_set('comment_edit_id', $user_id_ary);
		$db->sql_query($sql);
		
		$sql = 'UPDATE ' . KB_EDITS_TABLE . " SET edit_user_color = '" . $db->sql_escape($sql_ary['user_colour']) . "'
				WHERE " . $db->sql_in_set('edit_user_id', $user_id_ary);
		$db->sql_query($sql);
		
		$sql = 'UPDATE ' . KB_REQ_TABLE . " SET request_user_color = '" . $db->sql_escape($sql_ary['user_colour']) . "'
				WHERE " . $db->sql_in_set('request_user_id', $user_id_ary);
		$db->sql_query($sql);]]></action>
							</edit>
						</open>
		<open src="language/en/common.php">
											<edit>
							<find><![CDATA['KB_EXPLAIN'			=> 'Knowledge Base',]]></find>
															<action type="after-add"><![CDATA['ARTICLES'			=> 'Articles',]]></action>
													</edit>
									</open>
		<open src="language/en/acp/styles.php">
											<edit>
							<find><![CDATA['IMG_BUTTON_COMMENT_NEW'	=> 'New comment',]]></find>
															<action type="after-add"><![CDATA['IMG_BUTTON_REQUEST_NEW'	=> 'New request',]]></action>
													</edit>
									</open>
		<open src="styles/prosilver/imageset/en/imageset.cfg">
								<edit>
									<find><![CDATA[img_button_article_new = button_article_new.gif*25*96
img_button_comment_new = button_comment_new.gif*25*96]]></find>
									<action type="replace-with"><![CDATA[img_button_article_new = button_article_new.gif*25*107
img_button_comment_new = button_comment_new.gif*25*121
img_button_request_new = button_request_new.gif*25*116]]></action>
								</edit>
							</open>
		<open src="viewtopic.php">
							<edit>
								<find><![CDATA[$user_cache[$poster_id] = array(
				'joined'		=> '',
				'posts'			=> '',]]></find>
								<action type="after-add"><![CDATA[			'articles'		=> '',]]></action>
							</edit>
							<edit>
								<find><![CDATA[$user_cache[$poster_id] = array(
				'joined'		=> $user->format_date($row['user_regdate']),
				'posts'			=> $row['user_posts'],]]></find>
								<action type="after-add"><![CDATA[			'articles'		=> $row['user_articles'],]]></action>
							</edit>
							<edit>
								<find><![CDATA[	'POSTER_JOINED'		=> $user_cache[$poster_id]['joined'],
		'POSTER_POSTS'		=> $user_cache[$poster_id]['posts'],]]></find>
								<action type="after-add"><![CDATA[		'POSTER_ARTICLES'	=> $user_cache[$poster_id]['articles'],
		'U_POSTER_ARTICLES' => append_sid($phpbb_root_path . 'kb.' . $phpEx, 'i=search&amp;author_id= ' . $poster_id),]]></action>
							</edit>
						</open>
		<diy-instructions lang="en"><![CDATA[After completing this guide, login as admin and direct your browser to kb.php to update the mod.]]></diy-instructions>
	</action-group>
</mod>